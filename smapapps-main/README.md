# SMAPapps

## Description

**The SMAPapps project comprises python scripts that manipulate the output files of the SMAP software package (Schaumont et al., in prep.) into customised figures and ready-to-use input files for downstream data analyses. The SMAPapps repository contains three components:
1. **SMAPapp-Matrix** converts a haplotypes table generated by SMAP haplotype-sites or SMAP haplotype-window into pairwise genetic similarity/distance and/or locus information matrixes. The output matrixes are created in customised, high-quality figures or in standard output file formats for downstream data analyses.
2. **SMAPapp-Select** selects a subset of samples and/or loci in a haplotypes table generated by SMAP haplotype-sites or SMAP haplotype-window. The subset of samples and loci is printed to a new haplotypes table conform to the table structure of SMAP haplotype.
3. **SMAPapp-Barplot** summarises haplotype count data in a haplotypes table generated by SMAP haplotype-sites or SMAP haplotype-window into barplots. Locus information includes counts of the number of loci with a certain number of haplotypes or the genetic correspondence between samples in the haplotypes table and a set of reference samples. The output barplots are created as customised, high-quality figures.

## Citation

## Requirements

SMAPapp-Matrix, SMAPapp-Select, and SMAPapp-Barplot were developed in python 3.8.
Further requirements are listed, tagged per component: <sup>m</sup>SMAPapp-Matrix; <sup>s</sup>SMAPapp-Select, and <sup>b</sup>SMAPapp-Barplot. All scripts were optimized using the given package versions, but other package versions may work fine as well.

pandas v1.3.4<sup>m,b</sup>, matplotlib v3.4.3<sup>m,b</sup>, seaborn v0.11.2<sup>m,b</sup>, natsort v7.1.1<sup>m</sup>, and numpy v1.21.2<sup>b</sup>.

The following packages are part of the python standard library, hence they are normally installed together with python:
os<sup>m,s,b</sup>, argparse<sup>m,s,b</sup>, datetime<sup>m,s,b</sup>, multiprocessing<sup>m,b</sup>, math<sup>m</sup>, and random<sup>m</sup>

## Building and installing

### SMAPapp-Matrix

SMAPapp-Matrix estimates pairwise genetic similarities or distances between accessions in a haplotypes table created by SMAP haplotype-sites or SMAP haplotype-windows. The haplotypes table is the only argument that is mandatory to run the script. Haplotypes calls in the table can be discrete (e.g. 0, 1 or 2) for individuals or frequencies (a floating point between 0 en 1). We refer to the SMAP documentation for detailed instructions on best practices for haplotyping.

#### Defining sample names and sample order
By default, genetic similarities are calculated between all pairs of samples and sample names in each output file correspond to the names in the haplotypes table. The order of the sample names in the matrixes correspond to the order in the haplotypes table. However, a custom list containing a subset of sample names can be parsed as a tab-delimited text file to the script via the --samples option to limit the analyses to a subset of samples. The order of the sample names in the --samples list defines the order of the samples in all created matrixes: first sample = top (vertical axis) and left (horizontal axis) position, last sample = bottom (vertical axis) and right (horizontal axis) position. Sample names must exactly match to the sample names in the haplotypes table. Users can also choose to rename (some) samples by adding a second column to the --samples file with new sample names. A sample is not renamed if the cell in the second column of the corresponding row is left blank. Two or more samples are merged into one sample if the corresponding cells in the second column contain the same new sample name. The values of the merged sample are equal to the sum of the haplotype counts/frequencies of the separate samples.

#### Locus selection
Genetic similarity calculations can also be limited to a subset of loci by parsing a tab-delimited text file to the script containing a list of locus IDs via the --loci option. All other loci in the haplotypes table are ignored. Locus IDs must exactly match to the IDs in the haplotypes table.

#### Filtering for locus and/or sample completeness

Prior to the genetic similarity calculations, the haplotypes table can be filtered for locus completeness. The locus completeness is the minimum *proportion* of samples with haplotype calls in each locus. Loci with a lower proportion of samples with data are excluded from all downstream calculations. For example, locus A in Table 1 has haplotype calls in three samples (1, 2, and 3), locus B has calls in one sample (1), and locus C has calls in two samples (1 and 3). A value for the locus completeness of 0.3 would not exclude any samples from downstream calculations, whereas a locus completeness of e.g. 0.5 would remove locus 2 from the table. The threshold value of the locus completeness is preferably chosen in function of the total number of samples and the overall data completeness in the haplotypes table.

**Table 1.** Example of a haplotypes table containing calls from three loci (A, B, and C) in three samples (Sample 1, Sample 2, and Sample 3). Each locus has two haplotypes (00 and 10).
| Locus | Haplotype | Sample 1 | Sample 2 | Sample 3 |
| ----- | --------- | -------- | -------- | -------- |
| A     | 00        | 0        | 0        | 1        |
| A     | 10        | 1        | 1        | 0        |
| B     | 00        | 1        | <NA>     | <NA>     |
| B     | 10        | 0        | <NA>     | <NA>     |
| C     | 00        | 1        | <NA>     | 1        |
| C     | 10        | 0        | <NA>     | 1        |

After the selection of loci with a minimum proportion of samples with haplotype calls, a sample completeness filter can be applied. The sample completeness is the minimum *number* of loci with haplotype calls in each sample. Samples with a lower number of loci with data are discarded. For example, sample 1 in Table 1 has three loci with haplotype calls (A, B, C), sample 2 has one locus with haplotype calls (A), and sample 3 has two loci with haplotype calls (A and B). A value for the sample completeness equal to 1 would not exclude any samples, but a sample completeness equal to 2 would discard sample 2.

#### Plot line curves

To obtain a fair estimate of an appropriate sample completeness, the user can conduct a dry run of the script with a sample completeness of zero (default) and create line curves of the genetic similarity in function of the number of loci using the --plot_line_curves option. These curves show intermediate values for the genetic similarity calculated after every *x* loci (with *x* the user-defined locus interval, default = 10). Genetic similarity estimates usually fluctuate in the first part of the line curve, but stabilize once a substantial number of loci is included in the calculations. A further increase in the number of loci may not result in strong fluctuations in the genetic similarity estimate. Consequently, the number of loci that correspond to a stable genetic similarity value in most samples might be an appropriate value for the sample completeness. Genetic similarity values of sample pairs with a lower number of loci may not be reliable, because the estimate may change considerably if the number of loci in the calculation would be increased. By default, line curves are created for all sample pairs in the haplotypes table. The order of the sample pairs correspond to the order in the (renamed/rearranged) haplotypes table, and the line curves of all pairs with the same first sample (i.e. the reference sample) will be combined into the same plot. However, the user can choose to plot line curves for only a subset of sample pairs. The list of all pairs of which line curves must be created (first column = first/reference  sample, second column = second sample) can be parsed to the script via the --list_line_curves option.

#### Estimate pairwise genetic similarities and distances

Genetic similarity is expressed as the following coefficients:

Jaccard = a / (a + b + c) (Jaccard, 1912)

Sorensen-Dice = 2a / (2a + b + c) (Dice, 1945; Sørensen, 1948)

Ochiai = a / sqrt((a + b) * (a + c)) (Ochiai, 1957)

With *a* the number of shared haplotypes between accession 1 and 2, *b* the number of unique haplotypes in accession 1, and *c* the number of unique haplotypes in accession 2. The copy number of shared and unique haplotypes is not taken into account in a haplotype table consisting of discrete dosage calls. For example, if the copy number of a haplotype in both members of a sample pairs is 2, the number of shared haplotypes is set to 1 (instead of 2). As such, the Jaccard genetic similarity values do not depend on the use of discrete dominant calls or discrete dosage calls.

The genetic similarity between a pair of samples is calculated by default based on all shared loci in a sample pair, which are the loci with haplotype calls in both samples (no missing data). Non-shared loci (i.e. loci with missing data in minimum one out of two samples) can be included in the calculations by using the --include_non_shared_loci option. However, we recommend to only include non-shared loci in genetic similarity calculations if the information content of the set of shared loci is insufficiently high and the absence of data in a sample likely has a biological explanation (e.g. restriction site polymorphisms in highly saturated genotyping-by-sequencing data). Locus A in Table 1 is an example of a shared locus in every pairwise comparison, because all three samples have haplotype calls for locus A. Locus B is an example of a non-shared locus in every pairwise comparison, because only sample 1 has haplotype calls for that locus (data for samples 2 and 3 are missing). Consequently, no sample pair exists with haplotype calls from locus B in both members of the pair. Locus C is a non-shared locus in sample pair 1 vs 2 and pair 2 vs 3 because sample 2 has no haplotype calls for locus C, but it is a shared locus in sample pair 1 vs 3 because both samples in this pair have haplotype calls for that locus.

Pairwise similarity estimates can be converted into genetic distances using the inversed or the Euclidean transformation method:

Inversed = 1 - similarity

Euclidean = sqrt((1 - similarity)^2)

#### Calculate the locus information content

In addition to the pairwise genetic similarity, the number of informative loci can also be calculated for each pair of samples. The user can choose the criterion that is used to define the information content of a locus via the --locus_information_criterion option:

- shared: a locus with *only* shared haplotypes in a pair of samples (default, e.g. locus A for sample pair 1 vs 2 in Table 2)
- unique: a locus with *only* unique haplotypes in a pair of samples (e.g. locus A for sample pair 1 vs 3 in Table 2)

The definition of a locus with shared/unique haplotypes can be broadened by using the --partial option so that all loci with *at least* one shared/unique haplotype, respectively, are taken into account. In Table 1 for instance, locus C has is a partially informative locus in the sample pair 1 vs 3 because these samples have one shared haplotype (i.e. haplotype 00) and one haplotype unique to sample 3 (i.e. haplotype 10) on locus C..

The script also calculates the number of sample pairs for which a locus is informative. These numbers can be useful if subsets of loci must be created for downstream data analyses. If an informative locus is defined based on unique haplotypes, than the sample names with only unique haplotypes in all sample pairs (--partial = FALSE) or with a unique combination of haplotypes (--partial = TRUE) are also identified for each locus.

#### Output file formats

All output files are saved to the user-defined output directory (default = current directory). The output directory is created by the script if the directory did not exist. The output format of all matrixes can be chosen via the --print_sample_information option. By default, the matrix is printed to a tab-delimited text file. The default format of these tab-delimited text files is phylip, which can directly be imported in R (R core team, 2020) to reconstruct PCoA plots with the *cmdscale* function or a distance-based phylogenetic tree (e.g. with the *nj* function in the R package ape (Paradis & Schliep, 2018)). Alternatively, matrixes can be exported in Nexus format, which can for instance be used to reconstruct distance-based phylogenetic networks with the program SplitsTree (Huson & Bryant, 2006).

Alternatively (or additionally), the matrixes can be printed as graphs in one of the following formats:

- Portable document format (pdf)
- Portable network graphics (png)
- Scalable vector graphics (svg)
- Joint photographic experts group (jpg and jpeg)
- Tagged image file format (tif and tiff)

The font name and size of different elements in the graphs can be changed via the options --font, --title_fontsize, --label_fontsize, --tick_fontsize, and --legend_fontsize. The legend position and resolution of the plot can be adjusted using the --legend_position and --plot_resolution options, respectively. Different colour maps are also available via the --colour_map option to customize the colour scale in the matrixes. Users can choose to mask one half of the matrix (either all elements above the main diagonal or all elements below the main diagonal) to avoid redundancy in the matrix.

Matrixes with the number of informative loci in every sample pair can be printed to tab-delimited text files in phylip or nexus format and/or as graphs in one of the file formats listed above. In addition, a list of all loci included in the analyses together with the number of sample pairs for which the loci were informative, the total number of sample pairs for which the loci were considered, and the proportion of sample pairs for which the loci were informative. If the locus information criterion is set to 'unique', the names of samples with a unique haplotype for the corresponding locus in all sample pairs are also listed in this file.

Bootstrap replicates of the genetic similarity/distance matrix can be constructed to obtain statistical support for the inferred relationships between accessions, for instance in a distance-based phylogenetic tree. Pairwise genetic similarity/distances in bootstrap replicates are estimated in a set of loci that is randomly sampled with replacement from the original set of loci.

Users can adjust the default thresholds of filters throughout the procedure. See detailed description of the workflow for explanation of the filter parameters.

#### Usage

`python3 SMAPapp-Matrix.py -t, --table TABLE [-i INPUT_DIRECTORY] [-n SAMPLES] [-l LOCI] [-lc LOCUS_COMPLETENESS] [-sc SAMPLE_COMPLETENESS] [--include_non_shared_loci] [--similarity_coefficient {Jaccard, Sorensen-Dice, Ochiai}] [--distance] [--distance_method {Inversed, Euclidean}] [-lic LOCUS_INFORMATION_CRITERION {Shared, Unique}] [--partial] [-b BOOTSTRAP] [-p PROCESSES] [-o OUTPUT_DIRECTORY] [-s SUFFIX] [--print_sample_information {Matrix, Plot, All}] [--print_locus_information {None, Matrix, Plot, List, All}] [--matrix_format {Phylip, Nexus}] [--plot_format {pdf, png, svg, jpg, jpeg, tif, tiff}] [--mask {None, Upper, Lower}] [--annotate_matrix_plots] [--no_matrix_plot_labels] [--plot_line_curves] [--list_line_curves LIST_LINE_CURVES] [--locus_interval LOCUS_INTERVAL] [-f {Times New Roman, Arial, Calibri, Consolas, Verdana, Helvetica, Comic Sans MS}] [--title_fontsize TITLE_FONTSIZE] [--label_fontsize LABEL_FONTSIZE] [--tick_fontsize TICK_FONTSIZE] [--legend_fontsize LEGEND_FONTSIZE] [--legend_position X, Y] [-r PLOT_RESOLUTION] [--colour_map {viridis, plasma, inferno, magma, cividis, Greys, Purples, Blues, Greens, Oranges, Reds, YlOrBr, YlOrRd, OrRd, PuRd, RdPu, BuPu, GnBu, PuBu, YlGnBu, PuBuGn, BuGn, YlGn, binary, gist_yarg, gist_gray, gray, bone, pink, spring, summer, autumn, winter, cool, Wistia, hot, afmhot, gist_heat, copper, PiYG, PRGn, BrBG, PuOr, RdGy, RdBu, RdYlBu, RdYlGn, Spectral, coolwarm, bwr, seismic, twilight, twilight_shifted, hsv}]`

**Mandatory argument**

	-t, --table STR Name of the haplotypes table retrieved from SMAP haplotype-sites or SMAP haplotype-windows in the input directory.

**Input data options**

	-i, --input_directory STR Input directory containing the haplotypes table, the --samples text file, and/or the --loci text file [current directory].
	-n, --samples         STR Name of a tab-delimited text file in the input directory defining the order of the (new) sample IDs in the matrix: first column = old IDs, second column (optional) = new IDs [no list provided, the order of sample IDs in the matrix equals their order in the haplotypes table].
	-l, --loci            STR Name of a tab-delimited text file in the input directory containing a one-column list of locus IDs formatted as in the haplotypes table [no list provided].

**Analysis options**

	-lc, --locus_completeness                                     FLOAT Minimum proportion of samples with haplotype data in a locus. Loci with less data are removed [all loci are included].
	-sc, --sample_completeness                                    INT   Minimum number of loci with haplotype data in a sample. Samples with less data are removed [all samples are included].
	--include_non_shared_loci                                           Loci with data in only one out of two samples in each comparison are included in genetic similarity and locus information calculations [only loci with data in both samples of each comparison are included in calculations].
	-s, --similarity_coefficient {Jaccard, Sorensen-Dice, Ochiai} STR   Coefficient used to express pairwise genetic similarity between samples [Jaccard, other options are: Sorensen-Dice and Ochiai].
	--distance                                                          Convert genetic similarity estimates into genetic distances [no conversion to distances].
	--distance_method {Inversed, Euclidean}                       STR   Method used for genetic distance calculations [Inversed, other option is: Euclidean].
	-lic, --locus_information_criterion {Shared, Unique}          STR   Create a matrix showing the number of loci with shared or unique haplotypes in each comparison [Shared (matrix showing the number of loci with shared haplotypes), other option is: Unique (matrix showing the number of loci with unique haplotypes].
	--partial                                                           Include loci in the locus information matrix with at least one shared/unique haplotype [only loci with only shared/unique haplotypes are included].
	-b, --bootstrap                                               INT   The number of bootstrap replicates of the genetic similarity/distance matrix [no bootstrap replicates].
	-p, --processes                                               INT   Number of processes used by the script [4].

**Output data options**

	-o, --output_directory                                                                    STR          Output directory [current directory].
	-s, --suffix                                                                              STR          Suffix added to all output file names [no suffix added].
	--print_sample_information {Matrix, Plot, All}                                            STR          Print the similarity/distance matrix and the number of (shared) loci to the output directory as matrixes (Matrix option, .csv file) and/or as plots (Plot option, file type specified by --plot_format option) [Matrix].
	--print_locus_information {None, Matrix, Plot, List, All}                                 STR          Print locus information to the output directory as a matrix (Matrix option, .csv file) and/or as a plot (Plot option, file type specified by --plot_format option) showing the number of loci with shared or unique haplotypes in each comparison. The locus information per locus can also be printed as a tab-delimited list (List option, .txt file) showing the number of comparisons wherein the locus was informative and the sample IDs with unique haplotypes in all comparisons for each locus [locus information is not printed].
	--matrix_format {Phylip, Nexus}                                                           STR          Format of the similarity/distance matrix [Phylip].
	--plot_format {pdf, png, svg, jpg, jpeg, tif, tiff}                                       STR          File format of plots [pdf].
	--mask {None, Upper, Lower}                                                               STR          Mask values on the main diagonal of each matrix and above (upper) or below (lower) the main diagonal [no masking].
	--annotate_matrix_plots                                                                                Annotate the matrix plots with values [no annotations].
	--no_matrix_plot_labels                                                                                Do not plot labels on the axes of matrix plots [labels are plotted on the axes of matrix plots].
	--plot_line_curves                                                                                     Plot line curves showing the genetic correspondence between two samples in function of a cumulative number of loci [curves are not plotted].
	--list_line_curves                                                                                     Tab-delimited text file containing a list of sample comparisons (first column = ID of the first sample, second column = ID of the second sample) of which line curves need to be plotted [no list specified, all comparisons are plotted if the --plot_line_curves option is specified].
	--locus_interval                                                                          INT          Interval in the number of loci between two consecutive points in the line curves [10].
	-f, --font {Times New Roman, Arial, Calibri, Consolas, Verdana, Helvetica, Comic Sans MS} STR          Font used in all plots [Times_New_Roman].
	--title_fontsize                                                                          FLOAT        Title font size in points [12].
	--label_fontsize                                                                          FLOAT        Label font size in points [12].
	--tick_fontsize                                                                           FLOAT        Tick font size in points [8].
	--legend_fontsize                                                                         FLOAT        Legend font size in points [10].
	--legend_position                                                                         FLOAT, FLOAT Pair of coordinates defining the x (first number) and y (second number) position of the legend in the line curve plots [1,1, i.e. position the legend in the top right corner of the plot].
	-r, --plot_resolution                                                                     FLOAT        Plot resolution in dots per inch (dpi) [300].
	--colour_map  {viridis, plasma, inferno, magma, cividis, Greys, Purples, Blues, Greens, Oranges, Reds, YlOrBr, YlOrRd, OrRd, PuRd, RdPu, BuPu, GnBu, PuBu, YlGnBu, PuBuGn, BuGn, YlGn, binary, gist_yarg, gist_gray, gray, bone, pink, spring, summer, autumn, winter, cool, Wistia, hot, afmhot, gist_heat, copper, PiYG, PRGn, BrBG, PuOr, RdGy, RdBu, RdYlBu, RdYlGn, Spectral, coolwarm, bwr, seismic, twilight, twilight_shifted, hsv} STR  Colour palette used in the matrix plots. The (Perceptually Uniform) Sequential colormaps that are shown on the site of MatPlotLib (https://matplotlib.org/stable/tutorials/colors/colormaps.html) are accepted [bone].

#### Tutorial for SMAPapp-Matrix

The tutorial for SMAPapp-Matrix can be found [here](/Tutorials/Tutorial_SMAPapp_Matrix.md).

### SMAPapp-Select
SMAPapp-Select is a small tool to filter a haplotypes table generated by SMAP haplotype-sites or SMAP haplotype-windows for a subset of samples or a subset of loci.

#### Subset of samples
The subset of samples that must be retained in the table can be parsed to the script as a tab-delimited text file via the --samples option. That list consists of at least one column containing the original sample names (one sample name per row), which must exactly match to the names in the original haplotypes table. In addition, the --samples list may have a second column (for some samples) containing new sample names used to rename samples.

#### Subset of loci
Additionally or alternatively to the selection of samples in a haplotypes table, the script can select a subset of loci in the haplotypes table and print the corresponding haplotype calls to a new haplotypes table. The subset of loci must be specified as a one-column list in a tab-delimited text file. After all filter steps, SMAPapp-Select excludes by default loci that are not polymorphic (anymore). A polymorphic locus is defined as a locus with at least two different combinations of haplotypes found among samples. For example, locus A and locus B in Table 2 are polymorphic loci, because sample 2 has a different combination of haplotypes for those loci (0/1 in locus A and 1/1 in locus B) compared to sample 1 and sample 3 (both 1/0 in locus A and 1/0 in locus B). Consequently, two different combinations of haplotypes in two different combinations were found among all three samples. Locus C is not a polymorphic locus, because all three samples have the same haplotype calls resulting in only one combination of haplotypes (1/0). In addition to the removal of non-polymorphic loci, haplotypes that are completely absent in all remaining samples in the table (i.e. a call equal to 0 or missing data in all samples) are discarded.

**Table 2.** Example of a haplotypes table containing calls from two loci (A and B) in three samples (Sample 1, Sample 2, and Sample 3). Each locus has two haplotypes (00 and 10).
| Locus | Haplotype | Sample 1 | Sample 2 | Sample 3 |
| ----- | --------- | -------- | -------- | -------- |
| A     | 00        | 1        | 0        | 1        |
| A     | 10        | 0        | 1        | 0        |
| B     | 00        | 1        | 1        | 1        |
| B     | 10        | 0        | 1        | 0        |
| C     | 00        | 1        | 1        | 1        |
| C     | 10        | 0        | 0        | 0        |

#### Output file format
The output file generated by SMAPapp-Select is a haplotypes table in the same format as the tables generated by SMAP haplotype-sites and SMAP haplotype-windows.


#### Usage

`python3 SMAPapp-Select.py -t, --table TABLE [-i INPUT_DIRECTORY] [-n SAMPLES] [-l LOCI] [--keep_non_polymorphic_loci] [-o OUTPUT_DIRECTORY] [-s SUFFIX]`

**Mandatory argument**

	-t, --table STR Name of the haplotypes table retrieved from SMAP haplotype-sites or SMAP haplotype-windows in the input directory.

**Input data options**

	-i, --input_directory STR Input directory containing the haplotypes table, the --samples text file, and/or the --loci text file [current directory].
	-n, --samples         STR Name of a tab-delimited text file in the input directory defining the subset and order of the (new) sample names in the matrix: first column = old names, second column (optional) = new names [no sample list, the order of samples in the matrix equals their order in the haplotypes table].
	-l, --loci            STR Name of a tab-delimited text file in the input directory containing a one-column list of locus IDs formatted as in the haplotypes table [no list provided].

**Analysis options**

	--keep_non_polymorphic_loci Keep non-polymorphic loci in the filtered output file [non-polymorphic loci are removed].

**Output data options**

	-o, --output_directory STR  Output directory [current directory].
	-s, --suffix           STR  Suffix of the output haplotypes table [selection].

#### Tutorial for SMAPapp-Select

The tutorial for SMAPapp-Select can be found [here](/Tutorials/Tutorial_SMAPapp_Select.md).

### SMAPapp-Barplot

SMAPapp-Barplot visualises the number of loci with a given haplotype count for each sample or the genetic correspondence of each sample to (a set of) reference samples in a barplot. The haplotypes table is the only mandatory argument of the script. 

#### Defining sample names and sample order
By default, each sample is included in the barplot. However, a custom list (column) containing a subset of sample names can be parsed as a tab-delimited text file to the script via the --samples option to limit the number of samples in the plot. The order of the sample names in that list defines the order of the samples in the barplot: first sample = left position, last sample = right position. Sample names must exactly match to the sample names in the haplotypes table. Users can also choose to rename (some) samples by adding a second column to the --samples file with new sample names. A sample is not renamed if the cell in the second column of the corresponding row is left blank. Two or more samples are merged into one sample if the corresponding cells in the second column contain the same new sample name. The values of the merged sample are equal to the maximum of the haplotype counts/frequencies of the separate samples.

#### Locus selection
The haplotype count or the estimation of genetic correspondence can also be limited to a subset of loci by parsing a tab-delimited text file to the script containing a list with a subset of locus IDs via the --loci option. Locus IDs must exactly match to the IDs in the haplotypes table. The user can also opt to parse an additional haplotypes table to the script. By doing so, the user can for instance combine the information of a haplotypes table with discrete calls (e.g. individual-seq data) and a haplotypes table with frequencies (e.g. pool-seq data) in one barplot.

#### Barplot type
The script can create barplots that visualise two types of information in the haplotypes table. The type of information displayed in the barplot can be specified by the --type argument:

- haplotype_count (default): count the number of haplotypes in each locus and create a barplot showing the share of loci with a given number of haplotypes. Loci with a number of haplotypes lower or equal to the ploidy level (specified by the --ploidy option) are assigned to a separate category, whereas loci with a higher number of haplotypes than the specified ploidy level are combined into one category (i.e. more than *x* haplotypes, with *x* equal to the ploidy level).
- reference_similarity: expresses the haplotype correspondence between a given sample and a reference sample in a barplot. The reference samples must be specified as a list in a tab-delimited text file containing their (renamed) sample IDs, which is parsed to the script via the --reference_samples option. One category is included in the barplot for every reference sample. Two extra categories (i.e. unassigned and unknown) are added to the barplot to refer to haplotypes that are not unique to one reference sample in regard to the other reference samples (unassigned) or to haplotypes that were called in a sample but not found in any of the reference samples (unknown).

The colours in barplots displaying haplotype counts can be specified as a comma-separated list of full colour names, HEX codes, or RGB triplets using the --colours option. The colours referring to (some of) the reference samples in the barplot can be specified as a second column in the --reference_samples file with a colour specification (defined by its full colour name or as a HEX code or RGB triplet). These colours will be used in the barplots to refer to their corresponding reference samples. The user can choose to restrict the calculations of the haplotype similarity between all samples and the predefined reference samples to haplotypes that are unique to a reference sample compared to the other reference samples using the --unique_haplotypes option.

The values in the barplots are by default displayed as count data (i.e. the number of loci with *x* haplotypes or the number of haplotypes corresponding to each reference sample), but these numbers can be converted into one of the measures that can be specified by the --value_type option:

- mean: the mean of all loci with *x* haplotypes (haplotype count) or of the number of haplotypes similar to each reference sample (reference similarity)
- median: the median of all loci with *x* haplotypes (haplotype count) or of the number of haplotypes similar to each reference sample (reference similarity)
- percentage: the percentage of loci with *x* haplotypes (haplotype count) or the percentage of haplotypes similar to one of the reference samples (reference similarity)
- minimum: the minimum haplotype count in a locus (haplotype count) or the minimum similarity to a reference sample of a locus (reference similarity) in each sample
- maximum: the maximum haplotype count in a locus (haplotype count) or the maximum similarity to a reference sample of a locus (reference similarity) in each sample


#### Output file formats
Barplots can be printed as graphs in one of the following formats:

- Portable document format (pdf)
- Portable network graphics (png)
- Scalable vector graphics (svg)
- Joint photographic experts group (jpg and jpeg)
- Tagged image file format (tif and tiff)

The direction of barplots (i.e. horizontal or vertical) can be specified using the --plot_direction option, whereas the type of barplot (i.e. stacked or unstacked) can be changed using the --plot_type option. 


The font name and size of different elements in the graphs can be changed via the options --font, --title_fontsize, --label_fontsize, --tick_fontsize, and --legend_fontsize. The legend position and resolution of the plot can be adjusted using the --legend_position and --plot_resolution options, respectively. Users can choose to print a table with the number of loci with a certain number of haplotypes per sample (haplotypes_count) or the haplotype similarity of a sample with each of the reference samples (reference_similarity) as a tab-delimited text by setting the --print_sample_information option. That information can also be retrieved for each locus separately using the --print_locus_information option. The haplotype counts or reference similarity values of loci with unique haplotypes can also be visualised per locus in a heatmap using the --plot_heatmap option. Heatmap axes labels can be masked with the --no_heatmap_labels option, and the heatmap can be annotated with haplotype counts or reference similarities by setting the --annotate_heatmap option. Heatmaps can be coloured using the (Perceptually Uniform) All sequential colour maps available in the MatPlotLib library (https://matplotlib.org/stable/tutorials/colors/colormaps.html).

#### Usage

`python3 SMAPapp-Barplot.py -t, --table TABLE [-i INPUT_DIRECTORY] [-n SAMPLES] [-l LOCI] [-r REFERENCE_SAMPLES] [-a ADDITIONAL_TABLE] [--type {haplotype_count, reference_similarity}] [--ploidy PLOIDY] [--value_type {count, mean, median, percentage, minimum, maximum}] [--unique_haplotypes] [-p PROCESSES] [-o OUTPUT_DIRECTORY] [-s SUFFIX] [-b BAR_WIDTH] [--plot_type {unstacked, stacked}] [--plot_direction {vertical, horizontal}] [-f {Times New Roman, Arial, Calibri, Consolas, Verdana, Helvetica, Comic Sans MS}] [--title_fontsize TITLE_FONTSIZE] [--label_fontsize LABEL_FONTSIZE] [--tick_fontsize TICK_FONTSIZE] [--legend_fontsize LEGEND_FONTSIZE] [--legend_position X, Y] [-r PLOT_RESOLUTION] [--colours COLOURS] [--print_sample_information]`

**Mandatory argument**

	-t, --table STR Name of the haplotypes table retrieved from SMAP haplotype-sites or SMAP haplotype-windows in the input directory.

**Input data options**

	-i, --input_directory   STR Input directory containing the haplotypes table, the --samples text file, the --loci text file, --reference_samples text file, and/or the --reference_samples_table file [current directory].
	-n, --samples           STR Name of a tab-delimited text file in the input directory defining the order of the (new) sample IDs in the barplot: first column = old IDs, second column (optional) = new IDs [no list provided, the order of sample IDs in the barplot equals their order in the haplotypes table].
	-l, --loci              STR Name of a tab-delimited text file in the input directory containing a one-column list of locus IDs formatted as in the haplotypes table [no list provided].
	-r, --reference_samples STR Name of a tab-delimited text file in the input directory listing the (new) IDs of samples used as references in the bar plot: first column = sample name, second column: colour ID [no list with reference samples IDs is not provided].
	-a, --additional_table  STR Name of an additional haplotypes table retrieved from SMAP haplotype-sites or SMAP haplotype-windows in the input directory [no additional haplotypes table provided].

**Analysis options**

	--type {haplotype_count, reference_similarity}                   STR Type of the categories in the bar plot. Two options are allowed: haplotype_count (i.e. the number of loci with x haplotypes, with x between one and the ploidy level plus one) and reference_similarity (the number of loci with x haplotypes equal to one of the specified reference samples [haplotype_count].
	--ploidy                                                         INT Integer defining the (highest) ploidy level of the samples in the haplotypes table [2, diploid].
	--value_type {count, mean, median, percentage, minimum, maximum} STR Type of values displayed in the bar plots. Six options are allowed: count, mean, median, percentage, minimum and maximum [count].
	--unique_haplotypes                                                  Only use haplotypes that are unique to one of the reference samples to calculate the reference similarity [all haplotypes (unique and non-unique) are used to calculate the reference similarity].
	-p, --processes                                                  INT Number of processes used by the script [4].

**Output data options**

	-o, --output_directory                                                                    STR      Output directory [current directory].
	-s, --suffix                                                                              STR      Suffix added to all output file names [no suffix added].
	-b, --bar_width                                                                           FLOAT    Float number defining the width of each bar in the bar plot [0.3].
	--plot_type {unstacked, stacked}                                                          STR      Bar plot type. Two options are allowed: unstacked and stacked [unstacked].
	--plot_direction {vertical, horizontal}                                                   STR      Direction of the bar plot. Two options are allowed: vertical and horizontal [vertical].
	--plot_reference                                                                                   Include reference samples in the barplot [reference samples are not included].
	--plot_format {pdf, png, svg, jpg, jpeg, tif, tiff}                                       STR      File format of plots [pdf].
	-f, --font {Times New Roman, Arial, Calibri, Consolas, Verdana, Helvetica, Comic Sans MS} STR      Font used in all plots [Times_New_Roman].
	--title_fontsize                                                                          INT      Title font size in points [12].
	--label_fontsize                                                                          INT      Label font size in points [12].
	--tick_fontsize                                                                           INT      Tick font size in points [8].
	--legend_fontsize                                                                         INT      Legend font size in points [10].
	--legend_position                                                                         INT, INT Pair of coordinates defining the x (first number) and y (second number) position of the legend in the line curve plots [1,1, i.e. position the legend in the top right corner of the plot].
	-r, --plot_resolution                                                                     INT      Plot resolution in dots per inch (dpi) [300].
	--colours                                                                                 STR      Comma-separated list of colours used in the barplot [category10 color palette, more info on: https://github.com/d3/d3-3.x-api-reference/blob/master/Ordinal-Scales.md#category10].
	--print_sample_information                                                                         Print a table with the haplotype count or the similarity to the reference samples (columns) for each sample (rows) to a tab-delimited text file [sample information is not printed].
	--print_locus_information                                                                          Print a table with the haplotype count or the similarity to the reference samples (columns) for each locus in each sample (rows) to a tab-delimited text file [locus information is not printed].
	--plot_heatmap                                                                                     Plot a heatmap displaying the haplotype count or reference similarity on all loci (rows) per sample (columns) [no heatmap is plotted].
	--no_heatmap_labels                                                                                Do not plot labels on heatmap axes [labels are plotted on the axes of heatmap].
	--annotate_heatmap                                                                                 Annotate heatmap plots with haplotype counts or reference similarities [no heatmap annotations].
	--colour_map                                                                                       Colour palette used in the heatmap plots [bone]. The (Perceptually Uniform) All sequential colormaps listed on the site of MatPlotLib (https://matplotlib.org/stable/tutorials/colors/colormaps.html) are accepted.

## References
## References
Dice, L. R. (1945). Measures of the Amount of Ecological Association between Species. *Ecology, 26*(3), 297-302. https://doi.org/10.2307/1932409

Huson, D. H. & Bryant, D. (2006). Application of Phylogenetic Networks in Evolutionary Studies. *Molecular Biology and Evolution, 23*(2), 254-267. https://doi.org/10.1093/molbev/msj030

Jaccard, P. (1912). The distribution of the flora in the Alpine zone. *New Phytologist, 11*(2), 37-50. https://doi.org/10.1111/j.1469-8137.1912.tb05611.x

Ochiai, A. (1980). Zoogeographical Studies on the Soleoid Fishes Found in Japan and Its Neighbouring Regions - II. *Bulletin of the Japanese Society of Scientific Fisheries, 22*(9), 526–530. https://doi.org/10.15080/agcjchikyukagaku.58.4_256

Paradis, E. & Schliep, K. 2018. ape 5.0: an environment for modern phylogenetics and evolutionary analyses in R. *Bioinformatics 35*(3): 526-528. https://doi.org/10.1093/bioinformatics/bty633

R Core Team (2020). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/

Sørensen, T. (1948). A Method of Establishing Groups of Equal Amplitude in Plant Sociology based on Similarity of Species Content and its Application to Analyses of the Vegetation on Danish Commons. *Kongelige Danske Videnskabernes Selskab, 5*(4), 1–34.


